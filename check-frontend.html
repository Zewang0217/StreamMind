<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯ä»£ç æ£€æŸ¥ - å®æ—¶å†…å®¹é¢„è­¦ç³»ç»Ÿ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
        .check-item { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰ç«¯ä»£ç å…¼å®¹æ€§æ£€æŸ¥</h1>
    <p>æ£€æŸ¥å‰ç«¯ä»£ç æ˜¯å¦æ­£ç¡®ä½¿ç”¨AlertMessageå®ä½“ç±»çš„å­—æ®µ</p>
    
    <div id="check-results"></div>
    
    <script>
        // æ¨¡æ‹ŸAlertMessageå®ä½“ç±»ç»“æ„
        class MockAlertMessage {
            constructor(data) {
                this.id = data.id;
                this.topic = data.topic;
                this.userId = data.userId;
                this.windowEnd = data.windowEnd;
                this.negativeScore = data.negativeScore;
                this.toxicScore = data.toxicScore; // é‡è¦ï¼šè¿™æ˜¯æ–°æ·»åŠ çš„å­—æ®µ
                this.message = data.message;
                this.createdAt = data.createdAt;
            }
            
            // Lombok @Data è‡ªåŠ¨ç”Ÿæˆçš„getteræ–¹æ³•
            getId() { return this.id; }
            getTopic() { return this.topic; }
            getUserId() { return this.userId; }
            getWindowEnd() { return this.windowEnd; }
            getNegativeScore() { return this.negativeScore; }
            getToxicScore() { return this.toxicScore; } // é‡è¦ï¼šè¿™æ˜¯æ–°æ·»åŠ çš„getter
            getMessage() { return this.message; }
            getCreatedAt() { return this.createdAt; }
        }
        
        // æ¨¡æ‹Ÿæ•°æ®
        const mockData = {
            id: 1,
            topic: "weibo",
            userId: "user123",
            windowEnd: new Date(),
            negativeScore: 0.75,
            toxicScore: 0.32, // æ¯’æ€§åˆ†æ•°
            message: "æµ‹è¯•é¢„è­¦æ¶ˆæ¯",
            createdAt: new Date()
        };
        
        const alert = new MockAlertMessage(mockData);
        const results = [];
        
        function addResult(type, message) {
            results.push({ type, message });
        }
        
        // æ£€æŸ¥1: éªŒè¯getteræ–¹æ³•å­˜åœ¨
        try {
            if (typeof alert.getToxicScore === 'function') {
                const toxicScore = alert.getToxicScore();
                if (toxicScore === 0.32) {
                    addResult('success', 'âœ… getToxicScore() æ–¹æ³•å­˜åœ¨ä¸”å·¥ä½œæ­£å¸¸');
                } else {
                    addResult('error', `âŒ getToxicScore() è¿”å›å€¼å¼‚å¸¸: ${toxicScore}`);
                }
            } else {
                addResult('error', 'âŒ getToxicScore() æ–¹æ³•ä¸å­˜åœ¨');
            }
        } catch (e) {
            addResult('error', `âŒ getToxicScore() è°ƒç”¨å¼‚å¸¸: ${e.message}`);
        }
        
        // æ£€æŸ¥2: éªŒè¯å…¶ä»–å…³é”®getteræ–¹æ³•
        const requiredGetters = ['getNegativeScore', 'getTopic', 'getUserId', 'getCreatedAt'];
        requiredGetters.forEach(getter => {
            try {
                if (typeof alert[getter] === 'function') {
                    const value = alert[getter]();
                    addResult('success', `âœ… ${getter}() æ–¹æ³•å­˜åœ¨ï¼Œè¿”å›å€¼: ${value}`);
                } else {
                    addResult('error', `âŒ ${getter}() æ–¹æ³•ä¸å­˜åœ¨`);
                }
            } catch (e) {
                addResult('error', `âŒ ${getter}() è°ƒç”¨å¼‚å¸¸: ${e.message}`);
            }
        });
        
        // æ£€æŸ¥3: éªŒè¯JavaScriptå¯¹è±¡å±æ€§è®¿é—®
        try {
            if (alert.toxicScore !== undefined) {
                addResult('success', `âœ… JavaScriptå±æ€§è®¿é—®æ­£å¸¸: alert.toxicScore = ${alert.toxicScore}`);
            } else {
                addResult('error', 'âŒ JavaScriptå±æ€§è®¿é—®å¼‚å¸¸: toxicScoreæœªå®šä¹‰');
            }
        } catch (e) {
            addResult('error', `âŒ JavaScriptå±æ€§è®¿é—®å¼‚å¸¸: ${e.message}`);
        }
        
        // æ£€æŸ¥4: éªŒè¯å‰ç«¯æ¨¡æ¿ä»£ç å…¼å®¹æ€§
        const templateTests = [
            {
                code: 'alert.toxicScore > 0.5',
                test: () => alert.toxicScore > 0.5,
                expected: false
            },
            {
                code: 'alert.getToxicScore() > 0.5',
                test: () => alert.getToxicScore() > 0.5,
                expected: false
            },
            {
                code: '(alert.toxicScore || 0) * 100',
                test: () => (alert.toxicScore || 0) * 100,
                expected: 32
            }
        ];
        
        templateTests.forEach(test => {
            try {
                const result = test.test();
                if (result === test.expected) {
                    addResult('success', `âœ… æ¨¡æ¿ä»£ç å…¼å®¹æ€§æ­£å¸¸: ${test.code} = ${result}`);
                } else {
                    addResult('warning', `âš ï¸ æ¨¡æ¿ä»£ç ç»“æœå¼‚å¸¸: ${test.code} = ${result}, æœŸæœ›: ${test.expected}`);
                }
            } catch (e) {
                addResult('error', `âŒ æ¨¡æ¿ä»£ç æ‰§è¡Œå¼‚å¸¸: ${test.code} - ${e.message}`);
            }
        });
        
        // æ˜¾ç¤ºç»“æœ
        const resultsContainer = document.getElementById('check-results');
        resultsContainer.innerHTML = results.map(result => 
            `<div class="check-item ${result.type}">${result.message}</div>`
        ).join('');
        
        // æ€»ç»“
        const successCount = results.filter(r => r.type === 'success').length;
        const errorCount = results.filter(r => r.type === 'error').length;
        const warningCount = results.filter(r => r.type === 'warning').length;
        
        addResult('info', `ğŸ“Š æ£€æŸ¥å®Œæˆï¼š${successCount}é¡¹é€šè¿‡ï¼Œ${errorCount}é¡¹é”™è¯¯ï¼Œ${warningCount}é¡¹è­¦å‘Š`);
        
        if (errorCount === 0) {
            addResult('success', 'ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å‰ç«¯ä»£ç ä¸AlertMessageå®ä½“ç±»å…¼å®¹ã€‚');
        } else {
            addResult('error', 'âŒ å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦ä¿®å¤åç«¯å®ä½“ç±»æˆ–å‰ç«¯ä»£ç ã€‚');
        }
        
        // é‡æ–°æ˜¾ç¤ºåŒ…å«æ€»ç»“çš„ç»“æœ
        resultsContainer.innerHTML = results.map(result => 
            `<div class="check-item ${result.type}">${result.message}</div>`
        ).join('');
    </script>
</body>
</html>
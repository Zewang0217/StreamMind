# 流处理实战开发检查清单 ✅

## 项目启动前检查

### 环境检查
- [ ] Java 17+ 已安装 (`java -version`)
- [ ] Maven 3.6+ 已安装 (`mvn -version`)
- [ ] Docker 已启动 (`docker ps`)
- [ ] Kafka容器已启动 (`docker-compose up -d`)

### 项目结构检查
```
StreamMind_KafkaDemo/
├── common/                    # 共享模块
│   ├── src/main/java/org/zewang/common/
│   │   ├── dto/              # 数据传输对象
│   │   ├── constant/         # 常量定义
│   │   └── serde/            # 序列化工具
│   └── pom.xml
├── collector-service/         # 数据采集服务
│   ├── src/main/java/org/zewang/collectorservice/
│   │   ├── service/          # 业务服务
│   │   └── config/           # 配置类
│   └── pom.xml
├── stream-analyzer/          # 流分析服务
│   ├── src/main/java/org/zewang/streamanalyzer/
│   │   ├── processor/        # 流处理器
│   │   ├── service/          # 业务服务
│   │   └── config/           # 流配置
│   └── pom.xml
├── alert-service/            # 预警服务
│   ├── src/main/java/org/zewang/alertservice/
│   └── pom.xml
├── docker-compose.yml        # Docker配置
└── pom.xml                   # 父项目配置
```

## Common模块开发检查

### 数据结构定义
- [ ] `SocialMessage` record已创建 ✓
- [ ] `AnalyzedMessage` record已创建 ✓
- [ ] `Alert` record已创建
- [ ] `KafkaConstants` 常量类已创建 ✓
- [ ] Json序列化器已配置 ✓

### 关键代码检查
```java
// 检查record定义是否正确
@Builder
public record SocialMessage(
    String messageId,    // ✅ 有messageId
    String source,       // ✅ 有source
    String topic,        // ✅ 有topic  
    String userId,       // ✅ 有userId
    LocalDateTime timestamp, // ✅ 有时间戳
    String content,      // ✅ 有内容
    int interactionCount // ✅ 有互动数
) {}
```

## Collector-Service开发检查

### 基础配置
- [ ] 主类已创建并添加`@EnableScheduling`
- [ ] application.yml配置文件已创建
- [ ] 端口配置为8082

### 核心功能实现
- [ ] CSV数据加载功能 ✓
- [ ] 定时任务配置 ✓
- [ ] Kafka生产者配置 ✓
- [ ] 消息发送功能 ✓

### 配置检查
```yaml
# application.yml
collector:
  send-interval: 100      # 发送间隔(毫秒)
  batch-size: 10          # 每批发送数量
  data-file: classpath:csv/sample-data.csv  # 数据文件

spring:
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      retries: 3
      batch-size: 16384
      buffer-memory: 33554432
```

### 运行测试
- [ ] 启动应用：`mvn spring-boot:run`
- [ ] 检查日志是否有错误
- [ ] 确认消息发送到Kafka
```bash
# 检查Kafka主题
docker exec -it kafka kafka-topics.sh --list --bootstrap-server localhost:9092

# 消费消息查看
docker exec -it kafka kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic social-messages \
  --from-beginning
```

## Stream-Analyzer开发检查

### 基础配置
- [ ] 主类已创建
- [ ] Kafka Streams配置已创建
- [ ] 端口配置为8083

### 流处理实现
- [ ] 输入流配置：social-messages
- [ ] 处理逻辑实现：情感分析
- [ ] 输出流配置：analyzed-stream
- [ ] 批处理器实现（可选优化）

### 关键代码检查
```java
@Bean
public KStream<String, SocialMessage> kStream(StreamsBuilder streamsBuilder) {
    KStream<String, SocialMessage> inputStream = streamsBuilder
        .stream(KafkaConstants.SOCIAL_MESSAGES_TOPIC);
    
    KStream<String, AnalyzedMessage> analyzedStream = inputStream
        .mapValues(this::analyzeMessage);  // ✅ 关键处理逻辑
    
    analyzedStream.to(KafkaConstants.ANALYZED_STREAM_TOPIC);
    
    return inputStream;
}
```

### 批处理优化检查（如果使用）
- [ ] BatchAIAnalysisProcessor已实现
- [ ] 批处理大小配置合理（50条）
- [ ] 刷新时间配置合理（10秒）
- [ ] 异常处理机制已添加
- [ ] 降级策略已实现

### 运行测试
- [ ] 启动应用
- [ ] 检查流处理拓扑是否正确创建
- [ ] 确认输出主题有数据
```bash
# 检查输出主题
docker exec -it kafka kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic analyzed-stream \
  --from-beginning
```

## Alert-Service开发检查

### 基础功能
- [ ] 主类已创建
- [ ] 端口配置为8084
- [ ] Kafka消费者配置已创建

### 预警逻辑实现
- [ ] 情感预警：sentimentScore < -0.5
- [ ] 毒性预警：toxicityScore > 0.7
- [ ] 预警级别计算：HIGH/MEDIUM/LOW
- [ ] 预警消息发送到alert-events主题

### 预警规则配置
```yaml
alert:
  rules:
    negative-sentiment:
      threshold: -0.5
      severity: 
        high: -0.8
        medium: -0.5
    high-toxicity:
      threshold: 0.7
      severity:
        high: 0.9
        medium: 0.7
```

### 持久化实现（可选）
- [ ] AlertRecord实体类已创建
- [ ] JPA Repository已创建
- [ ] 预警存储服务已实现

### 运行测试
- [ ] 启动应用
- [ ] 检查预警消息生成
- [ ] 验证预警规则触发
```bash
# 检查预警主题
docker exec -it kafka kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic alert-events \
  --from-beginning
```

## 集成测试检查

### 全流程测试
- [ ] 启动所有服务
- [ ] 确认数据流转：
  1. CSV数据 → social-messages
  2. social-messages → analyzed-stream
  3. analyzed-stream → alert-events

### 性能检查
- [ ] 消息处理延迟检查
- [ ] 内存使用情况检查
- [ ] CPU使用率检查

### 异常场景测试
- [ ] Kafka断开连接测试
- [ ] 服务重启测试
- [ ] 数据格式错误测试

## 监控和日志检查

### 日志配置
```xml
<!-- logback-spring.xml -->
<configuration>
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <logger name="org.apache.kafka" level="WARN"/>
    <logger name="org.springframework.kafka" level="INFO"/>
    <logger name="org.zewang" level="DEBUG"/>
    
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>
</configuration>
```

### 关键日志检查点
- [ ] 服务启动日志
- [ ] Kafka连接日志
- [ ] 消息发送/接收日志
- [ ] 错误和异常日志

## 部署前最终检查

### 代码质量
- [ ] 代码注释完整
- [ ] 异常处理完善
- [ ] 配置外部化
- [ ] 日志级别合适

### 性能优化
- [ ] 批处理大小调优
- [ ] Kafka参数调优
- [ ] JVM参数调优
- [ ] 连接池配置

### 安全性
- [ ] 敏感信息脱敏
- [ ] 输入数据验证
- [ ] 异常信息脱敏
- [ ] 访问控制配置

## 故障排查快速指南

### 服务启动失败
1. 检查端口冲突：`netstat -anp | grep 808x`
2. 检查Kafka连接：`telnet localhost 9092`
3. 检查配置文件语法
4. 查看详细日志：`--debug`参数

### 消息处理异常
1. 检查主题是否存在
2. 检查序列化配置
3. 查看消费者组状态
4. 检查消息格式

### 性能问题
1. 检查批处理大小
2. 检查线程池配置
3. 监控JVM内存使用
4. 查看Kafka集群状态

---

## ✅ 完成确认

**项目名称：** StreamMind Kafka流处理系统
**完成状态：** _______________
**测试人员：** _______________
**完成时间：** _______________

**备注：**
_________________________________
_________________________________

**下一步计划：**
□ 功能完善和优化
□ 性能测试和调优  
□ 监控和告警添加
□ 生产环境部署

---

*使用说明：每个检查项完成后在方框内打勾✓，确保每个阶段都完整实现后再进入下一阶段。*
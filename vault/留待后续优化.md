> BY KIMI AI

kimiå»ºè®®ï¼š

  ğŸ¯ é¡¹ç›®æ¶æ„åˆ†æ

  âœ… æ¶æ„è½¬å‹çš„åˆç†æ€§

  ä½ çš„é¡¹ç›®ä»ä¼ ç»Ÿçš„ producer/consumer/stream æ¶æ„è½¬å‹ä¸ºæ›´ä¸“ä¸šçš„å¾®æœåŠ¡æ¶æ„ï¼ˆcollector-service, stream-analyzer, alert-service
  ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¼”è¿›ï¼š

  ä¼˜åŠ¿ï¼š

  â€¢ èŒè´£åˆ†ç¦»æ›´æ¸…æ™°ï¼šæ•°æ®é‡‡é›†ã€æµå¤„ç†ã€é¢„è­¦å®Œå…¨è§£è€¦
  â€¢ ç‹¬ç«‹éƒ¨ç½²æ‰©å±•ï¼šå„æ¨¡å—å¯æ ¹æ®è´Ÿè½½ç‹¬ç«‹æ‰©ç¼©å®¹
  â€¢ æŠ€æœ¯æ ˆçµæ´»ï¼šä¸åŒæ¨¡å—å¯é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯æ–¹æ¡ˆ

  ğŸ“‹ æ ¸å¿ƒæ¨¡å—åˆ†æ

  1. Commonæ¨¡å— - â­â­â­â­â­

  äº®ç‚¹ï¼š

  // ä¼˜ç§€çš„record + Builderæ¨¡å¼è®¾è®¡
  @Builder
  public record SocialMessage (
      String messageId,
      String source,
      String topic,
      String userId,
      @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")
      LocalDateTime timestamp,
      String content,
      int interactionCount
  ) {}

  å»ºè®®ï¼š

  â€¢ âœ… å·²ç»å¾ˆå¥½åœ°ä½¿ç”¨äº†Java 17çš„recordç±»å‹
  â€¢ âœ… Builderæ¨¡å¼å¢åŠ äº†åˆ›å»ºçµæ´»æ€§
  â€¢ ğŸ’¡ å»ºè®®è¡¥å……ï¼šæ·»åŠ å­—æ®µéªŒè¯æ³¨è§£ï¼Œå¦‚@NotNullã€@Sizeç­‰

  2. Collector-Service - â­â­â­â­

  äº®ç‚¹ï¼š

  â€¢ ä½¿ç”¨OpenCSVä¼˜é›…å¤„ç†CSVæ•°æ®
  â€¢ åˆç†çš„å®šæ—¶ä»»åŠ¡é…ç½®ï¼ˆ10msé—´éš”ï¼Œæ¯æ¬¡10æ¡ï¼‰
  â€¢ æ™ºèƒ½çš„æ•°æ®å¾ªç¯ä½¿ç”¨æœºåˆ¶

  å»ºè®®ï¼š

  // å½“å‰ä»£ç 
  @Scheduled(fixedDelay = 10)
  public void sendBatchMessages() {
      // æ¯10mså‘é€10æ¡ï¼Œå¯èƒ½è¿‡äºé¢‘ç¹
  }

  ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š

  @Scheduled(fixedDelayString = "${collector.send-interval:100}") // å¯é…ç½®åŒ–
  public void sendBatchMessages() {
      int batchSize = Integer.parseInt(env.getProperty("collector.batch-size", "10"));
      // æ·»åŠ å‘é€é€Ÿç‡æ§åˆ¶
      RateLimiter rateLimiter = RateLimiter.create(1000); // æ¯ç§’æœ€å¤š1000æ¡
  }

  3. Stream-Analyzer - â­â­â­â­â­

  äº®ç‚¹ï¼š

  â€¢ ä¼˜ç§€çš„æ‰¹é‡å¤„ç†è®¾è®¡ï¼ˆ50æ¡æˆ–10ç§’è§¦å‘ï¼‰
  â€¢ å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†
  â€¢ ä½¿ç”¨Kafka Streamsçš„Processor APIï¼Œçµæ´»æ€§é«˜

  å»ºè®®ï¼š

  // å½“å‰åˆ·æ–°é—´éš”è®¾ç½®
  private static final Duration FLUSH_INTERVAL = Duration.ofSeconds(10);

  // å»ºè®®æ”¹ä¸ºå¯é…ç½®
  @Value("${analyzer.batch.size:50}")
  private int batchSize;

  @Value("${analyzer.flush.interval.seconds:10}")
  private Duration flushInterval;

  ğŸš¨ å…³é”®é—®é¢˜ä¸æ”¹è¿›å»ºè®®

  4. Alert-Serviceæ¨¡å—ç¼ºå¤± â­â­â­

  ç°çŠ¶ï¼š åªæœ‰ä¸€ä¸ªç©ºçš„åº”ç”¨å¯åŠ¨ç±» å»ºè®®å®ç°ï¼š

  @Service
  public class AlertProcessor {

      @KafkaListener(topics = KafkaConstants.ANALYZED_STREAM_TOPIC)
      public void processAnalyzedMessage(AnalyzedMessage message) {
          // æƒ…æ„Ÿé˜ˆå€¼é¢„è­¦
          if (message.sentimentScore() < -0.5) {
              sendAlert("NEGATIVE_SENTIMENT", message);
          }
          // æ¯’æ€§å†…å®¹é¢„è­¦
          if (message.toxicityScore() > 0.7) {
              sendAlert("HIGH_TOXICITY", message);
          }
      }

      private void sendAlert(String alertType, AnalyzedMessage message) {
          Alert alert = Alert.builder()
              .messageId(message.messageId())
              .alertType(alertType)
              .severity(calculateSeverity(message))
              .timestamp(LocalDateTime.now())
              .build();

          kafkaTemplate.send(KafkaConstants.ALERT_EVENTS_TOPIC, alert);
      }
  }

  5. çŠ¶æ€ç®¡ç†ä¸ç›‘æ§ç¼ºå¤± â­â­â­

  å»ºè®®æ·»åŠ ï¼š

  @Component
  public class StreamMetrics {

      private final MeterRegistry registry;

      public void recordProcessingLatency(long latencyMs) {
          registry.timer("stream.processing.latency").record(latencyMs, TimeUnit.MILLISECONDS);
      }

      public void recordBatchSize(int size) {
          registry.gauge("stream.batch.size", size);
      }
  }

  6. é…ç½®ç®¡ç†ä¼˜åŒ– â­â­â­â­

  å½“å‰ï¼š ç¡¬ç¼–ç é…ç½®è¾ƒå¤š å»ºè®®ï¼š ä½¿ç”¨Spring Booté…ç½®ä½“ç³»

  # application.yml
  collector:
    send-interval: 100ms
    batch-size: 10
    data-source: classpath:csv/sample-data.csv

  analyzer:
    batch-size: 50
    flush-interval: 10s
    ai-service:
      timeout: 30s
      retry-attempts: 3

  alert:
    sentiment-threshold: -0.5
    toxicity-threshold: 0.7

  7. é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶ â­â­â­

  å½“å‰ï¼š åªæœ‰ç®€å•çš„é™çº§å¤„ç† å»ºè®®å¢å¼ºï¼š

  @Retryable(value = {AiServiceException.class}, maxAttempts = 3, backoff = @Backoff(delay = 1000))
  public List<AnalyzedMessage> analyzeBatch(List<SocialMessage> messages) {
      // AIåˆ†æé€»è¾‘
  }

  @Recover
  public List<AnalyzedMessage> recoverFromAiFailure(AiServiceException e, List<SocialMessage> messages) {
      log.error("AIæœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é™çº§ç­–ç•¥");
      return messages.stream()
          .map(this::createNeutralAnalysis)
          .collect(Collectors.toList());
  }

  ğŸ¯ ä¸å¼€å‘æ–‡æ¡£çš„å¯¹åº”å…³ç³»

  ä½ çš„å®ç°å¾ˆå¥½åœ°å¯¹åº”äº†å¼€å‘æ–‡æ¡£çš„è§„åˆ’ï¼š

   å¼€å‘æ–‡æ¡£é˜¶æ®µ    å®é™…å®ç°                        å®Œæˆåº¦
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   V1.0 åŸºç¡€æµç¨‹   âœ… Collector+Analyzer+åŸºç¡€DTO   80%
   V1.5 å†å²åˆ†æ   âŒ å¾…å®ç°                       0%
   V2.0 å®æ—¶äº¤äº’   âŒ å¾…å®ç°                       0%

  ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®ä¼˜å…ˆçº§

  ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¤„ç†ï¼‰

  8. å®Œå–„Alert-Serviceï¼šå®ç°é¢„è­¦é€»è¾‘å’Œé˜ˆå€¼åˆ¤æ–­
  9. æ·»åŠ é…ç½®ç®¡ç†ï¼šæ›¿æ¢ç¡¬ç¼–ç é…ç½®
  10. å¢å¼ºé”™è¯¯å¤„ç†ï¼šå®ç°é‡è¯•å’Œé™çº§æœºåˆ¶

  âš¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå¤„ç†ï¼‰

  11. æ·»åŠ ç›‘æ§æŒ‡æ ‡ï¼šé›†æˆMicrometer + Prometheus
  12. å®ç°æ•°æ®æŒä¹…åŒ–ï¼šæ·»åŠ MySQLé›†æˆ
  13. æ·»åŠ APIæ¥å£ï¼šæä¾›æŸ¥è¯¢å’Œåˆ†ææ¥å£

  ğŸ”® ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

  14. å®ç°V1.5å†å²åˆ†æï¼šæ·»åŠ çŠ¶æ€å­˜å‚¨å’Œæ‰¹é‡å¤„ç†
  15. å®ç°V2.0å®æ—¶äº¤äº’ï¼šé›†æˆWebSocket
  16. æ€§èƒ½ä¼˜åŒ–ï¼šå¼‚æ­¥å¤„ç†ã€ç¼“å­˜ä¼˜åŒ–

  ğŸ’¡ æ€»ç»“

  ä½ çš„é¡¹ç›®æ¶æ„è®¾è®¡ä¼˜ç§€ï¼Œä»£ç è´¨é‡å¾ˆé«˜ï¼Œç‰¹åˆ«æ˜¯ï¼š

  â€¢ âœ… åˆç†ä½¿ç”¨Java 17æ–°ç‰¹æ€§ï¼ˆrecordã€varï¼‰
  â€¢ âœ… æ¨¡å—èŒè´£åˆ’åˆ†æ¸…æ™°
  â€¢ âœ… æµå¤„ç†è®¾è®¡åˆç†ï¼ˆæ‰¹å¤„ç†+æ—¶é—´çª—å£ï¼‰
  â€¢ âœ… å¼‚å¸¸å¤„ç†å®Œå–„

  ä¸»è¦æ”¹è¿›ç©ºé—´ï¼š Alert-Serviceè¡¥å…¨ã€é…ç½®ç®¡ç†ã€ç›‘æ§æŒ‡æ ‡ã€‚ç»§ç»­ä¿æŒè¿™ç§é«˜è´¨é‡çš„ä»£ç é£æ ¼ï¼